<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Tulika.io</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body { display: flex; align-items: center; justify-content: center; height: 100vh; background-color: var(--bg-primary); }
        .auth-container {
            width: 320px; padding: 20px; border-radius: 8px;
            background-color: var(--bg-secondary); border: 1px solid var(--border-color);
        }
        .auth-container h1 { text-align: center; }
        .auth-container input { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; background-color: var(--input-bg); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 4px;}
        .auth-container button { width: 100%; padding: 10px; border: none; border-radius: 4px; background-color: #007bff; color: white; cursor: pointer; }
        .auth-container button:hover { background-color: #0056b3; }
        .auth-container p { text-align: center; margin-top: 15px; }
        .auth-container a { color: #007bff; text-decoration: none; }
        .debug-info { margin-top: 20px; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="auth-container">
        <h1>Register</h1>
        <form id="registerForm">
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Register</button>
        </form>
        <p id="message" style="color: #0a0;"></p>
        <p>Already have an account? <a href="login.html">Login</a></p>
        
        <!-- Debug Information -->
        <div class="debug-info">
            <h4>Debug Information:</h4>
            <div id="debug-output"></div>
        </div>
    </div>

    <script>
        const debugOutput = document.getElementById('debug-output');
        
        function debugLog(message) {
            console.log(message);
            debugOutput.innerHTML += `<div>${message}</div>`;
        }
        
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            debugLog('Form submitted');
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            debugLog(`Username: ${username}, Password length: ${password.length}`);
            
            const formData = new FormData();
            formData.append('action', 'register');
            formData.append('username', username);
            formData.append('password', password);
            
            debugLog('FormData created, sending request...');
            
            try {
                debugLog('Attempting to connect to: api/auth.php');
                
                const response = await fetch('api/auth.php', { 
                    method: 'POST', 
                    body: formData 
                });
                
                debugLog(`Response status: ${response.status}`);
                debugLog(`Response headers: ${JSON.stringify([...response.headers])}`);
                
                const contentType = response.headers.get("content-type");
                debugLog(`Content type: ${contentType}`);
                
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    const result = await response.json();
                    debugLog(`JSON Response: ${JSON.stringify(result)}`);
                    
                    if (result.success) {
                        document.getElementById('message').textContent = 'Registration successful! Redirecting to login...';
                        setTimeout(() => window.location.href = 'login.html', 2000);
                    } else {
                        document.getElementById('message').style.color = '#c00';
                        document.getElementById('message').textContent = result.message || 'Registration failed.';
                    }
                } else {
                    const errorText = await response.text();
                    debugLog(`Non-JSON Response: ${errorText}`);
                    document.getElementById('message').style.color = '#c00';
                    document.getElementById('message').textContent = 'Server returned non-JSON response.';
                }
            } catch (error) {
                debugLog(`Fetch error: ${error.message}`);
                debugLog(`Error stack: ${error.stack}`);
                document.getElementById('message').style.color = '#c00';
                document.getElementById('message').textContent = 'Could not connect to the server.';
            }
        });
        
        // Test server connectivity on page load
        window.addEventListener('load', async () => {
            debugLog('Page loaded, testing server connectivity...');
            try {
                const response = await fetch('api/auth.php?action=status');
                debugLog(`Status check response: ${response.status}`);
                if (response.ok) {
                    debugLog('Server is reachable!');
                } else {
                    debugLog(`Server responded with error: ${response.status}`);
                }
            } catch (error) {
                debugLog(`Server connectivity test failed: ${error.message}`);
            }
        });
    </script>
</body>
</html>